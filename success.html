<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thank You - Camo Empire</title>
  <link rel="icon" href="https://images-ext-1.discordapp.net/external/XMhfFgTtFdf90ucYWmG0mP-Xrv1WaTtMvPYgno6FaA0/%3Fsize%3D4096/https/cdn.discordapp.com/icons/1302640777968484362/04cef4bcfbb925dcf32b620036c268e1.png?width=256&height=256" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Orbitron', sans-serif;
    }

    body {
      background: #0b0b12;
      color: #e0e0f8;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(90deg, #3e006a, #5e00aa);
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
    }

    header img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      box-shadow: 0 0 1px #ff66cc;
    }

    header h1 {
      color: white;
      font-size: 2.8rem;
      letter-spacing: 1px;
    }

    .thank-you-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
      text-align: center;
    }

    .thank-you-section img {
      width: 100px;
      height: 100px;
      margin-bottom: 20px;
    }

    .thank-you-section h2 {
      font-size: 2rem;
      color: #c084fc;
      margin-bottom: 10px;
    }

    .thank-you-section p {
      font-size: 1.2rem;
      color: #ccc;
      margin-bottom: 10px; /* Adjusted to reduce spacing after order details */
    }

    .instruction-box {
      background: #1a1a2e;
      border: 1px solid #3e3e66;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      width: 90%;
      text-align: left;
      margin-top: 20px; /* Added to maintain spacing */
    }

    .instruction-box h3 {
      font-size: 1.3rem;
      color: #ffffff;
      margin-bottom: 15px;
    }

    .instruction-box p {
      font-size: 1rem;
      color: #ccc;
      margin-bottom: 10px;
    }

    .instruction-box a {
      color: #b765ff;
      text-decoration: none;
      font-weight: bold;
    }

    .instruction-box a:hover {
      color: #d4b5ff;
    }

    .back-btn {
      display: block;
      text-align: center;
      margin: 30px auto;
      color: #ccc;
      text-decoration: none;
      font-size: 1rem;
      padding: 10px;
    }

    .back-btn:hover {
      color: #ffffff;
    }

    footer {
      text-align: center;
      background: #0f0f1f;
      padding: 20px;
      color: #666;
      font-size: 0.85rem;
    }

    /* Mobile-specific styles */
    @media (max-width: 768px) {
      header {
        padding: 20px;
      }
      header h1 {
        font-size: 2rem !important;
      }
      header img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 0 1px #ff66cc;
      }
      .thank-you-section {
        padding: 20px 10px;
      }
      .thank-you-section img {
        width: 80px;
        height: 80px;
      }
      .thank-you-section h2 {
        font-size: 1.5rem;
      }
      .thank-you-section p {
        font-size: 1rem;
      }
      .instruction-box {
        padding: 15px;
        width: 95%;
      }
      .instruction-box h3 {
        font-size: 1.2rem;
      }
      .instruction-box p {
        font-size: 0.95rem;
      }
      .back-btn {
        font-size: 0.95rem;
        padding: 15px;
      }
    }

    /* Extra small screens (e.g., < 480px) */
    @media (max-width: 480px) {
      header h1 {
        font-size: 2rem !important;
      }
      header img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 0 1px #ff66cc;
      }
      .thank-you-section img {
        width: 60px;
        height: 60px;
      }
      .thank-you-section h2 {
        font-size: 1.3rem;
      }
      .thank-you-section p {
        font-size: 0.9rem;
      }
      .instruction-box h3 {
        font-size: 1.1rem;
      }
      .instruction-box p {
        font-size: 0.9rem;
      }
    }

    /* Styles for Order ID and Product Purchased */
    #order-id, #product-name {
      display: inline-block;
      background: #1a1a2e;
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #3e3e66;
      margin: 0 5px;
      cursor: text;
      user-select: all; /* Makes it easier to select text for copying */
    }

    #order-details {
      background: #1a1a2e;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #3e3e66;
      display: inline-block;
      margin-top: 10px;
    }

    /* Ensure responsiveness on smaller screens */
    @media (max-width: 768px) {
      #order-id, #product-name {
        padding: 4px 8px;
        font-size: 0.95rem;
      }
      #order-details {
        padding: 8px;
      }
    }

    @media (max-width: 480px) {
      #order-id, #product-name {
        padding: 3px 6px;
        font-size: 0.9rem;
      }
      #order-details {
        padding: 6px;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://images-ext-1.discordapp.net/external/XMhfFgTtFdf90ucYWmG0mP-Xrv1WaTtMvPYgno6FaA0/%3Fsize%3D4096/https/cdn.discordapp.com/icons/1302640777968484362/04cef4bcfbb925dcf32b620036c268e1.png?width=256&height=256" alt="Logo">
    <h1>Camo Empire</h1>
  </header>

  <section class="thank-you-section">
    <img src="https://static.vecteezy.com/system/resources/previews/017/177/781/non_2x/green-tick-check-mark-on-transparent-background-free-png.png" alt="Green Checkmark">
    <h2>Payment Successful!</h2>
    <p>Thank You for Your Purchase!</p>
    <p id="order-details">Your Order ID: <span id="order-id">N/A</span> | Product Purchased: <span id="product-name">N/A</span></p>
    <div class="instruction-box">
      <h3>Next Steps</h3>
      <p>Thank you for choosing Camo Empire! To receive your purchased items, please follow these steps:</p>
      <p>1. Join our Discord server if you haven't already: <a href="https://discord.gg/zx2mg3vfdS" target="_blank">Join Discord</a>.</p>
      <p>2. Open a ticket in the Discord server under the appropriate channel.</p>
      <p>3. Provide your purchase details, including your order ID and email, in the ticket.</p>
      <p>4. Our team will process your request and deliver your items as soon as possible.</p>
      <p>If you have any questions, feel free to reach out in our Discord server or DM cranked2!</p>
    </div>
  </section>

  <a href="index.html" class="back-btn">← Back to Products</a>
  <footer>
    © 2025 Camo Empire. All rights reserved.
  </footer>
  <script>
    // Function to save order details to localStorage
    function saveOrderDetails(orderId, product) {
      if (orderId !== 'N/A' && product !== 'N/A') {
        localStorage.setItem('currentOrderId', orderId);
        localStorage.setItem('currentProduct', product);
      }
    }

    // Function to get order details from localStorage
    function getSavedOrderDetails() {
      return {
        orderId: localStorage.getItem('currentOrderId') || 'N/A',
        product: localStorage.getItem('currentProduct') || 'N/A'
      };
    }

    // Function to get query parameters from URL and localStorage fallback for orderId
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      let orderId = params.get('order_id') || localStorage.getItem('lastOrderId') || 'N/A';
      let product = params.get('product') || 'N/A';
      
      // Validate orderId to avoid using invalid values like {CLIENT_REFERENCE_ID}
      if (orderId.includes('{CLIENT_REFERENCE_ID}')) {
        orderId = localStorage.getItem('lastOrderId') || 'N/A';
      }

      // If we don't have valid data from URL params, try to get saved data
      if (orderId === 'N/A' || product === 'N/A') {
        const savedDetails = getSavedOrderDetails();
        if (orderId === 'N/A') orderId = savedDetails.orderId;
        if (product === 'N/A') product = savedDetails.product;
      }

      return {
        orderId: orderId,
        product: product
      };
    }

    // Function to check if webhook has already been sent for this order
    function hasWebhookBeenSent(orderId) {
      const sentWebhooks = JSON.parse(localStorage.getItem('sentWebhooks') || '[]');
      return sentWebhooks.includes(orderId);
    }

    // Function to mark webhook as sent for this order
    function markWebhookAsSent(orderId) {
      const sentWebhooks = JSON.parse(localStorage.getItem('sentWebhooks') || '[]');
      if (!sentWebhooks.includes(orderId)) {
        sentWebhooks.push(orderId);
        // Keep only the last 50 order IDs to prevent localStorage from growing too large
        if (sentWebhooks.length > 50) {
          sentWebhooks.splice(0, sentWebhooks.length - 50);
        }
        localStorage.setItem('sentWebhooks', JSON.stringify(sentWebhooks));
      }
    }

    // Function to send order details to Discord webhook
    async function sendToDiscordWebhook(orderId, product) {
      // Check if webhook has already been sent for this order
      if (hasWebhookBeenSent(orderId)) {
        console.log('Webhook already sent for order:', orderId);
        return;
      }

      const webhookUrl = 'https://discord.com/api/webhooks/1324089991973834854/Jr7-1peOyPAXdi1ATxiu5wxhMAUKLJB4kqlWNS6cnf7f-3lqqaQ8RuXzRBX3t0zg7OZX';
      const roleId = '1302721513576726580'; // Role ID to ping
      const payload = {
        content: `<@&${roleId}>`, // Ping the role
        embeds: [{
          title: 'New Order',
          color: 0x9b30ff, // Purple color to match theme
          fields: [
            { name: 'Order ID', value: orderId, inline: true },
            { name: 'Product Purchased', value: product, inline: true }
          ],
          timestamp: new Date().toISOString()
        }]
      };

      try {
        const response = await fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          console.error('Failed to send webhook:', response.statusText);
        } else {
          console.log('Webhook sent successfully');
          // Mark webhook as sent only after successful delivery
          markWebhookAsSent(orderId);
        }
      } catch (error) {
        console.error('Error sending webhook:', error);
      }
    }

    // Display order details and send to Discord webhook on page load
    window.addEventListener('load', () => {
      const { orderId, product } = getQueryParams();
      console.log('Success page loaded:', {
        queryOrderId: new URLSearchParams(window.location.search).get('order_id'),
        localStorageOrderId: localStorage.getItem('lastOrderId'),
        finalOrderId: orderId,
        product: product
      });
      
      // Save order details for future refreshes
      saveOrderDetails(orderId, product);
      
      document.getElementById('order-id').textContent = orderId;
      document.getElementById('product-name').textContent = product;
      if (orderId !== 'N/A' && product !== 'N/A') {
        sendToDiscordWebhook(orderId, product);
      }
      // Clear the temporary localStorage items but keep the current order details
      localStorage.removeItem('lastOrderId');
      localStorage.removeItem('lastProduct');
    });
  </script>
</body>
</html>
